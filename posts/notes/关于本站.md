---
title: '关于本站'
date: '2022-11-30'
year: '2022'
abstract: '这个网站背后的技术、开发时遇到的问题及解决'
---

# 关于本站

前段时候翻过去的笔记，看到 2 年前自己写完一个贪吃蛇小项目[留下的记录](/post/贪吃蛇)，当时费了九牛二虎之力让那蛇动起来，期间把浏览器搞崩溃。如今可以理解这些遗留代码，做些重构，也略得一些安慰，时间花在哪里，财宝就积累在哪里。

开发一个网站对我来说是个 0 到 1 的过程，本文记录开发本网站时遇到的问题、考虑问题的思路和解决方案。

## 创建网站：从源代码、构建到部署

Next.js 一把梭。

（以下内容基于 Next 12，前不久 Next 发布了 13 版，引入了服务端组件、对于路由和获取数据的方式也做了更新，未来做一下更新）

[创建项目](https://nextjs.org/docs/getting-started)：使用 Next.js 的提供的脚手架工具 `create-next-app`

开发：在 `src/pages` 下面写路由页面，文件名即 url 的路径名，想创建 `site.com/articles` 页面，展示所有文章列表，就新建 `src/pages/articles.tsx`，在其中写页面的内容，Next.js 自动处理了路由。

记录开发时的几个主要问题：

### 要注意正在写的代码是在浏览器端还是服务端处理的？

大部分是在服务端处理的。

### 全局通用的布局怎么处理？

一个网站一般分为 header、主体部分、footer，header 与 footer 是各页面通用的，各个页面写自己的内容，这种情况，在 `_app.tsx` 引入 `Layout` 组件，然后将各个页面作为其 children 嵌入即可。

本站稍微有些不同，除了首页的 header 和其他页的不一样。实现方式是：
  - `_app.tsx`： 中声明 `getLayout()` 方法，用 `getLayout()` 处理传入的 children
  - 各页面：导入 Layout 组件，实现 `getLayout()` 方法，将本页内容与 Layout 拼起来返回

### 文章详情页怎么处理？

文章详情页是根据它的 id 显示的，用[动态路由](https://nextjs.org/docs/routing/dynamic-routes)处理。实现方式：
  1. 用 `[pid].tsx` 方式命名需要动态路由处理的页面，如果博客中有10篇文章，那 `[pid].tsx` 代表了这10篇文章的详情页；
  2. 在该文件中实现两个方法：
    1. `getStaticPaths`: 返回一个 path 列表，告诉 Next.js 一共有多少页面按这种方式处理，具体使用参看源代码
    2. `getStaticProps`: 获取页面的详情，返回一个包含详情对象，对象会作为参数传入本页组件，具体使用参看源代码

## 内容

网站上线时有初始内容，随着网站运营又更新内容，这些内容是什么？这个问题取决于我认为什么东西值得写下来。对我来说，写文章是为了操练两点：

  1. 理清自己想要表达什么事情，或对已经发生的事情做个总结，加深印象；
  2. 觉察当下的处境，不带判断地记录问题、面对问题时的心态、自己的做法，留下时间长河中关于此刻状态的切片，留待后观。

我不期望自己发表什么深刻见解，毕竟很多时候我只是学习、重复已有的观点。我期望自己多动动笔，写点东西，然后有选择地放到网上。

现在的内容有三类：

`/文章`：随笔，是写着自娱的记录，感受居多；笔记，记录对我来说重要的事情，其中事实居多；参考，关于某个主题，给当下及未来某时刻的参考，内容来自 xx标准网、xx教程文档。
`/项目`：写过的项目。
`/关于`：面向找工作写的履历页。

对于网站的内容创作来说，创建者编辑完源文档（.md），交给网站，这过程就结束了。

## 样式

### 网站的整体样式

我没有系统学过UI设计，自顶向下为网站设计UI对我来说不知从何着手，尝试自主设计，发现自己反反复复于：花一天挑主题色、第二天推翻它、第三天继续挑主题色。这样来来回回耗费很多时间，因为无法在设计上做决定，也让我以为在开发工作上也无法推进。后来在设计这事上放过自己，决定哪个网站看得顺眼，就完全模仿它的设计，只做实现，不想为什么要用这个颜色的问题。

网站的整体样式来自 [Neil Sainsbury 的网站](https://www.neilwithdata.com/)，茫茫网络，偶然看到他的网站，觉得很简洁，照着实现了一遍。（最后链接：样式不错的网站列表）

开发网站时，有大部分时间在调试页面上的条条框框的布局、大小、彼此间距、颜色等事情，样式调多了也就不厌其烦。

### 文章内容的样式

就是你正在看的这篇文章的样式。

首先说明网站对文章内容的处理：

1. 写完文章，得到 md 文件，放到网站项目的 `/posts` 文件夹中，这事发生在现实生活中；
2. 用一个 markdown parser 将它解析转成 html 纯文本，通过 React “危险！设置”(`dangerouslySetInnerHTML`) 渲染成网页上，这事发生在构建过程中。

markdown parser 给我的是完整文章内容的 html 字符串，我无法在构建时给 html 做增强，怎么给文章设定样式呢？

现在采取的办法是将它放入容器，给容器一个 class，class 内部通过标签选择器为标签设定样式。

追求更精细地控制，需要仔细看一下 `remark` 这个 parser 的用法。

### Next.js 中写样式的方式

1. 全局样式

Next 12 中，用于做基础 html 模板的文件是`src/pages/_app.tsx`，要应用全局样式，就在该文件中导入全局样式表。

```js
// in src/pages/_app.tsx

import '../styles/global.scss';
```

2. 组件样式

- `CSS Modules`：Next.js 本身支持 `CSS Modules` 引入局部样式，用 `[name].module.css` 的方式给 css文件取名，在组件中导入即为局部样式，本站主要采用这种方式。
- `CSS-in-JS`：直接在 js 中写样式，用法是`<p style={{ color: 'red' }}>hi there</p>`，用得少。